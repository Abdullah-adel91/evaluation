<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª â€“ Ù…ØµÙÙˆÙØ© ÙˆØ£Ø­ØµØ§Ø¦ÙŠØ§Øª</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{direction:rtl;font-family:Arial;padding:10px;background:#f5f5f5}
table{border-collapse:collapse;width:100%;margin-bottom:20px;}
th,td{border:1px solid #ccc;padding:6px;text-align:center;}
th{background:#eee;}
.result{font-weight:bold;}
button{margin:3px;padding:6px 12px;font-size:16px;}
.hidden{display:none;}
select,input{padding:8px;font-size:16px;margin-top:5px;}
</style>
</head>
<body>

<h2 style="text-align:center">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª</h2>

<div>
  <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù:</label>
  <select id="employeeSelect"></select>
  <button onclick="addEmployee()">Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù…</button>
  <button onclick="saveEmployees()">Ø­ÙØ¸ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
</div>

<hr>

<h3>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª</h3>
<div id="criteria"></div>
<button onclick="saveEvaluation()">Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
<button onclick="resetView()">Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯</button>

<hr>

<h3>Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>
<button onclick="showMatrix()">ØµÙØ­Ø© Ø§Ù„Ù…ØµÙÙˆÙØ© (Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ã— Ø§Ù„Ø¨Ù†ÙˆØ¯)</button>
<button onclick="showStats()">Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</button>
<button onclick="showTopBottom()">Ø£ÙØ¶Ù„ ÙˆØ£Ø³ÙˆØ£ 5</button>
<button onclick="showDashboard()">Dashboard Ø¨ØµØ±ÙŠ</button>
<button onclick="downloadExcel()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„</button>
<button onclick="deleteAllData()">âŒ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>

<div id="output"></div>

<script>
/* Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
let employees = JSON.parse(localStorage.getItem("employees")) || ["Ù…Ø­Ù…Ø¯","Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡","Ø³Ø§Ø±Ø©"];
let evaluations = JSON.parse(localStorage.getItem("evaluations")) || [];
const criteriaList = [
"ØªØ±Ø­ÙŠØ¨ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø© ÙˆØ°ÙƒØ± Ø§Ù„Ø§Ø³Ù…",
"Ø·Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±Ùƒ ÙˆØ°ÙƒØ±Ù‡ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©",
"Ø£Ø®Ø° Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨",
"Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨",
"Ø£Ø®Ø° Ø¥Ø°Ù† Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ù‚Ø¨Ù„ ÙˆØ¶Ø¹Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",
"Ø¥Ø¯Ø§Ø±Ø© ÙˆÙ‚Øª Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©",
"Ø´ÙƒØ± Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",
"Ù†Ø¨Ø±Ø© ØµÙˆØª ÙˆØ§Ø¶Ø­Ø©",
"Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¹Ø¯Ø§Ø¯",
"ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©",
"Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­",
"Ù‡Ù„ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø© ØµØ­ÙŠØ­"
];

/* Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ù†ÙˆØ¯ */
function renderCriteria(){
  const div=document.getElementById("criteria");
  div.innerHTML="";
  criteriaList.forEach(c=>{
    div.innerHTML+=`<div class="item">${c}<br>
      <button onclick="setMark(this,'âœ”ï¸')">âœ”ï¸</button>
      <button onclick="setMark(this,'âœ–ï¸')">âœ–ï¸</button>
      <span class="result"></span>
    </div>`;
  });
}

function setMark(btn,val){
  btn.parentElement.querySelector('.result').innerText=val;
}

/* Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… */
function saveEvaluation(){
  const employee=document.getElementById("employeeSelect").value;
  if(!employee) return alert("Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù");
  const results=[...document.querySelectorAll('.result')];
  if(results.some(r=>!r.innerText)) return alert("Ù‚ÙŠÙ‘Ù… ÙƒÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯");
  results.forEach((r,i)=>{
    evaluations.push({
      name:employee,
      date:new Date().toLocaleDateString('ar-SA'),
      criteria:criteriaList[i],
      score:r.innerText
    });
  });
  localStorage.setItem("evaluations",JSON.stringify(evaluations));
  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… âœ”ï¸");
}

/* Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† */
function resetView(){
  document.querySelectorAll('.result').forEach(r=>r.innerText='');
}

/* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ */
function loadEmployeeNames(){
  const sel=document.getElementById("employeeSelect");
  sel.innerHTML="";
  employees.forEach(e=>sel.innerHTML+=`<option>${e}</option>`);
}
function addEmployee(){
  const name=prompt("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
  if(name){employees.push(name);loadEmployeeNames();}
}
function saveEmployees(){
  localStorage.setItem("employees",JSON.stringify(employees));
  alert("ØªÙ… Ø­ÙØ¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† âœ”ï¸");
}

/* Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£ÙÙ‚ÙŠØ© */
function showMatrix(){
  if(evaluations.length===0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª");
  const matrix={};
  employees.forEach(e=>matrix[e]={});
  criteriaList.forEach(c=>employees.forEach(e=>matrix[e][c]=0));
  evaluations.forEach(ev=>{
    if(ev.score==='âœ–ï¸') matrix[ev.name][ev.criteria]++;
  });
  let html=`<table><tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th>`;
  criteriaList.forEach(c=>html+=`<th>${c}</th>`);
  html+="</tr>";
  employees.forEach(e=>{
    html+=`<tr><td>${e}</td>`;
    criteriaList.forEach(c=>{
      html+=`<td>${matrix[e][c]>0?matrix[e][c]:0}</td>`;
    });
    html+="</tr>";
  });
  html+="</table>";
  document.getElementById("output").innerHTML=html;
}

/* Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ© */
function showStats(){
  if(evaluations.length===0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª");
  const stats={};
  employees.forEach(e=>stats[e]={total:0, errors:0});
  evaluations.forEach(ev=>{
    stats[ev.name].total++;
    if(ev.score==='âœ–ï¸') stats[ev.name].errors++;
  });
  let html=`<table><tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th><th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ù†ÙˆØ¯</th><th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</th><th>Ø§Ù„Ù†Ø³Ø¨Ø© %</th></tr>`;
  employees.forEach(e=>{
    const t=stats[e].total;
    const err=stats[e].errors;
    const pct=((t-err)/t*100).toFixed(2);
    html+=`<tr><td>${e}</td><td>${t}</td><td>${err}</td><td>${pct}</td></tr>`;
  });
  html+="</table>";
  document.getElementById("output").innerHTML=html;
}

/* Ø£ÙØ¶Ù„ ÙˆØ£Ø³ÙˆØ£ 5 */
function showTopBottom(){
  if(evaluations.length===0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª");
  const stats={};
  employees.forEach(e=>stats[e]={total:0, errors:0});
  evaluations.forEach(ev=>{
    stats[ev.name].total++;
    if(ev.score==='âœ–ï¸') stats[ev.name].errors++;
  });
  const sorted=Object.entries(stats).sort((a,b)=>a[1].errors-b[1].errors);
  const top5=sorted.slice(0,5);
  const bottom5=sorted.slice(-5);
  let html=`<h4>Ø£ÙØ¶Ù„ 5</h4><table><tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th><th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</th></tr>`;
  top5.forEach(e=>html+=`<tr><td>${e[0]}</td><td>${e[1].errors}</td></tr>`);
  html+="</table><h4>Ø£Ø³ÙˆØ£ 5</h4><table><tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th><th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</th></tr>";
  bottom5.forEach(e=>html+=`<tr><td>${e[0]}</td><td>${e[1].errors}</td></tr>`);
  html+="</table>";
  document.getElementById("output").innerHTML=html;
}

/* Dashboard Ø¨ØµØ±ÙŠ */
function showDashboard(){
  if(evaluations.length===0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª");
  const matrix={};
  criteriaList.forEach(c=>matrix[c]=0);
  evaluations.forEach(ev=>{if(ev.score==='âœ–ï¸') matrix[ev.criteria]++;});
  const ctxHTML='<canvas id="chart" width="400" height="400"></canvas>';
  document.getElementById("output").innerHTML=ctxHTML;
  const ctx=document.getElementById('chart').getContext('2d');
  new Chart(ctx,{
    type:'pie',
    data:{
      labels:Object.keys(matrix),
      datasets:[{
        label:'Ø£ÙƒØ«Ø± Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø´ÙŠÙˆØ¹Ù‹Ø§',
        data:Object.values(matrix),
        backgroundColor:[
          '#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF','#FF9F40',
          '#C9CBCF','#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF'
        ]
      }]
    },
    options:{
      responsive:true,
      plugins:{legend:{position:'right'}}
    }
  });
}

/* ØªØ­Ù…ÙŠÙ„ Ø§ÙƒØ³Ù„ ÙƒØ§Ù…Ù„ */
function downloadExcel(){
  if(evaluations.length===0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª");
  const rows=[["Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù","Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ù„Ø¨Ù†Ø¯","Ø§Ù„ØªÙ‚ÙŠÙŠÙ…"]];
  evaluations.forEach(e=>rows.push([e.name,e.date,e.criteria,e.score]));
  const ws=XLSX.utils.aoa_to_sheet(rows);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª");
  XLSX.writeFile(wb,"ØªÙ‚ÙŠÙŠÙ…Ø§Øª_Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†.xlsx");
}

/* Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
function deleteAllData(){
  if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")){
    localStorage.removeItem("evaluations");
    evaluations=[];
    alert("ØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ”ï¸");
  }
}

/* Ø§Ù„ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ Ù…Ø±Ø© */
renderCriteria();
loadEmployeeNames();
</script>

</body>
</html>
