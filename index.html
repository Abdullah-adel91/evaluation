<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body { direction: rtl; font-family: Arial; background: #f4f4f4; padding: 15px; }
.container { max-width: 700px; margin: auto; background:#fff; padding:15px; border-radius:10px; }
.item { background:#fafafa; border:1px solid #ddd; padding:10px; margin:6px 0; border-radius:6px; }
button, select { padding:8px 12px; margin:4px; font-size:16px; }
.result { font-weight:bold; font-size:16px; margin-right:8px; }
.hidden { display:none; }
.title { font-size:20px; font-weight:bold; text-align:center; margin-bottom:10px; }
</style>
</head>

<body>
<div class="container">

<div class="title">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª</div>

<!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¸Ù -->
<select id="employeeSelect"></select>
<button onclick="addEmployeePrompt()">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</button>
<br><br>

<!-- Ø§Ù„Ø¨Ù†ÙˆØ¯ -->
<div id="criteriaList"></div>

<p id="msg" class="hidden" style="color:red;text-align:center">âš ï¸ Ù‚ÙŠÙ‘Ù… ÙƒÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ù‚Ø¨Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</p>

<br>
<button onclick="saveEvaluation()">Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
<button onclick="showErrors()">Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</button>
<button onclick="resetCriteria()">Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯</button>

<hr>

<button onclick="downloadExcel()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Excel Ù„Ù„Ø´Ù‡Ø±</button>
<button onclick="clearMonth()">ğŸ—‘ï¸ Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‡Ø± ÙˆØ¨Ø¯Ø¡ Ø¬Ø¯ÙŠØ¯</button>

</div>

<script>
// ====== Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ ======
let employees = JSON.parse(localStorage.getItem("employees") || '["Ù…ÙˆØ¸Ù 1","Ù…ÙˆØ¸Ù 2"]');
let evaluations = JSON.parse(localStorage.getItem("evaluations") || "[]");

// ====== Ø§Ù„Ø¨Ù†ÙˆØ¯ ======
const criteria = [
 "ØªØ±Ø­ÙŠØ¨ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø© ÙˆØ°ÙƒØ± Ø§Ù„Ø§Ø³Ù…",
 "Ø·Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±Ùƒ ÙˆØ°ÙƒØ±Ù‡ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©",
 "Ø£Ø®Ø° Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨",
 "Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨",
 "Ø£Ø®Ø° Ø¥Ø°Ù† Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ù‚Ø¨Ù„ ÙˆØ¶Ø¹Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",
 "Ø¥Ø¯Ø§Ø±Ø© ÙˆÙ‚Øª Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©",
 "Ù†Ø¨Ø±Ø© ØµÙˆØª ÙˆØ§Ø¶Ø­Ø©",
 "Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¹Ø¯Ø§Ø¯",
 "ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©",
 "Ù‡Ù„ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø© ØµØ­ÙŠØ­"
];

// ====== Ø±Ø³Ù… Ø§Ù„Ø¨Ù†ÙˆØ¯ ÙÙŠ Ø§Ù„ØµÙØ­Ø© ======
function renderCriteria(){
 let area = document.getElementById("criteriaList");
 area.innerHTML = "";
 criteria.forEach(c=>{
   area.innerHTML += `
     <div class="item">
       ${c}
       <br>
       <button onclick="setMark(this,'âœ”ï¸')">âœ”ï¸</button>
       <button onclick="setMark(this,'âœ–ï¸')">âœ–ï¸</button>
       <span class="result"></span>
     </div>`;
 });
}

function setMark(btn,val){
 btn.parentElement.querySelector(".result").innerText = val;
}

function allChecked(){
 return [...document.querySelectorAll('.result')].every(r=>r.innerText !== "");
}

// ====== Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ======
function showErrors(){
 if(!allChecked()){
   msg.classList.remove("hidden");
   return;
 }
 msg.classList.add("hidden");
 document.querySelectorAll(".item").forEach(i=>{
   i.style.display = (i.querySelector(".result").innerText === 'âœ–ï¸') ? 'block' : 'none';
 });
}

// ====== Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯ ======
function resetCriteria(){
 document.querySelectorAll(".item").forEach(i=>{
   i.style.display='block';
   i.querySelector(".result").innerText='';
 });
 msg.classList.add("hidden");
}

// ====== Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ======
function loadEmployees(){
 let sel=document.getElementById("employeeSelect");
 sel.innerHTML="";
 employees.forEach(e=> sel.innerHTML += `<option>${e}</option>`);
}
function addEmployeePrompt(){
 let list=prompt("Ø§ÙƒØªØ¨ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©:\nÙ…Ø«Ø§Ù„: Ø§Ø­Ù…Ø¯ØŒ ÙÙ‡Ø¯ØŒ Ù†Ø§ØµØ±", employees.join("ØŒ "));
 if(list){
   employees=list.split(/[,ØŒ]/).map(e=>e.trim()).filter(e=>e);
   localStorage.setItem("employees",JSON.stringify(employees));
   loadEmployees();
 }
}

// ====== Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ======
function saveEvaluation(){
 if(!allChecked()) return alert("ÙŠØ¬Ø¨ ØªÙ‚ÙŠÙŠÙ… ÙƒÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯");

 let emp=document.getElementById("employeeSelect").value;
 let date=new Date().toLocaleDateString('ar-SA');

 criteria.forEach((c,i)=>{
   let score=document.querySelectorAll(".result")[i].innerText;
   let note = score==="âœ–ï¸" ? "Ø®Ø·Ø£" : "";
   evaluations.push({name:emp,date,criteria:c,score,note});
 });

 localStorage.setItem("evaluations",JSON.stringify(evaluations));
 alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ”ï¸");
}

// ====== Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‡Ø± ======
function clearMonth(){
 if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‡Ø±ØŸ")){
   evaluations=[];
   localStorage.setItem("evaluations","[]");
   alert("ØªÙ… Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‡Ø± Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ âœ”ï¸");
 }
}

// ====== ØªØ­Ù…ÙŠÙ„ Excel ======
function downloadExcel(){
 if(evaluations.length===0) return alert("Ù…Ø§ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª");

 const rows=[["Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù","Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ù„Ù…Ø¹ÙŠØ§Ø±","Ø§Ù„ØªÙ‚ÙŠÙŠÙ…","Ù…Ù„Ø§Ø­Ø¸Ø§Øª"]];
 evaluations.forEach(e=> rows.push([e.name,e.date,e.criteria,e.score,e.note]));

 const ws=XLSX.utils.aoa_to_sheet(rows);
 const wb=XLSX.utils.book_new();

 // Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¹Ù„Ù‰ Excel Ù„Ù„Ø¬ÙˆØ§Ù„
 Object.keys(ws).forEach(cell=>{
   if(cell[0]==='!')return;
   if(typeof ws[cell].v==='string'){
     ws[cell].v="\ufeff"+ws[cell].v;
   }
 });

 XLSX.utils.book_append_sheet(wb,ws,"Ø§Ù„Ø´Ù‡Ø±");
 XLSX.writeFile(wb,"ØªÙ‚ÙŠÙŠÙ…Ø§Øª_Ø§Ù„Ø´Ù‡Ø±.xlsx",{bookType:"xlsx",type:"file",compression:true});
}

// ====== ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ ======
renderCriteria();
loadEmployees();
</script>

</body>
</html>
