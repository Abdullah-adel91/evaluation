<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{direction:rtl;font-family:Arial;padding:10px;background:#f5f5f5}
.item{background:#fff;margin:6px 0;padding:10px;border-radius:8px}
button{margin:3px;padding:6px 12px;font-size:16px}
.result{font-size:18px;font-weight:bold;margin-right:8px}
.hidden{display:none}
select,input{padding:8px;font-size:16px;margin-top:5px}
</style>
</head>

<body>

<h2 style="text-align:center">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª</h2>

<!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¸Ù -->
<div>
  <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù:</label><br>
  <select id="employeeSelect"></select>
  <button onclick="addEmployee()">Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù…</button>
  <button onclick="saveEmployees()">Ø­ÙØ¸ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
</div>

<hr>

<!-- Ø§Ù„Ø¨Ù†ÙˆØ¯ -->
<div id="criteria"></div>

<!-- Ø£Ø²Ø±Ø§Ø± Ø±Ø¦ÙŠØ³ÙŠØ© -->
<br>
<button onclick="saveEvaluation()">Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
<button onclick="showErrors()">Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙ‚Ø·</button>
<button onclick="resetView()">Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯</button>

<hr>

<!-- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´Ù‡Ø± -->
<h3>Ø®ÙŠØ§Ø±Ø§Øª Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´Ù‡Ø±</h3>
<button onclick="downloadExcel()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„</button>
<button onclick="deleteAllData()">âŒ Ø­Ø°Ù ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‡Ø±</button>

<script>
/* â–‘â–‘â–’â–’ Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© â–’â–’â–‘â–‘ */

let employees = JSON.parse(localStorage.getItem("employees")) || ["Ù…Ø­Ù…Ø¯","Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡","Ø³Ø§Ø±Ø©"];
let evaluations = JSON.parse(localStorage.getItem("evaluations")) || [];

/* â–‘â–‘â–’â–’ Ø¨Ù†ÙˆØ¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… â–’â–’â–‘â–‘ */
const criteriaList = [
"ØªØ±Ø­ÙŠØ¨ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø© ÙˆØ°ÙƒØ± Ø§Ù„Ø§Ø³Ù…",
"Ø·Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±Ùƒ ÙˆØ°ÙƒØ±Ù‡ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©",
"Ø£Ø®Ø° Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨",
"Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨",
"Ø£Ø®Ø° Ø¥Ø°Ù† Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ù‚Ø¨Ù„ ÙˆØ¶Ø¹Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",
"Ø¥Ø¯Ø§Ø±Ø© ÙˆÙ‚Øª Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©",
"Ø´ÙƒØ± Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",
"Ù†Ø¨Ø±Ø© ØµÙˆØª ÙˆØ§Ø¶Ø­Ø©",
"Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¹Ø¯Ø§Ø¯",
"ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©",
"Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­",
"Ù‡Ù„ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø© ØµØ­ÙŠØ­"
];


/* â–‘â–‘â–’â–’ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ù†ÙˆØ¯ â–’â–’â–‘â–‘ */
function renderCriteria(){
  const div = document.getElementById("criteria");
  div.innerHTML = "";
  criteriaList.forEach(c=>{
    div.innerHTML += `
    <div class="item">
      ${c}<br>
      <button onclick="setMark(this,'âœ”ï¸')">âœ”ï¸</button>
      <button onclick="setMark(this,'âœ–ï¸')">âœ–ï¸</button>
      <span class="result"></span>
    </div>`;
  });
}

/* â–‘â–‘â–’â–’ ÙˆØ¶Ø¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… â–’â–’â–‘â–‘ */
function setMark(btn,val){
  btn.parentElement.querySelector('.result').innerText = val;
}

/* â–‘â–‘â–’â–’ Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… â–’â–’â–‘â–‘ */
function saveEvaluation(){
  const employee = document.getElementById("employeeSelect").value;
  if(!employee) return alert("Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù");

  const results = [...document.querySelectorAll('.result')];
  if(results.some(r=>!r.innerText)) return alert("Ù‚ÙŠÙ‘Ù… ÙƒÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯");

  results.forEach((r,i)=>{
    evaluations.push({
      name: employee,
      date: new Date().toLocaleDateString('ar-SA'),
      criteria: criteriaList[i],
      score: r.innerText,
      notes: r.innerText === "âœ–ï¸" ? "ÙˆØ¬ÙˆØ¯ Ø®Ø·Ø£" : "Ù„Ø§ ÙŠÙˆØ¬Ø¯"
    });
  });

  localStorage.setItem("evaluations",JSON.stringify(evaluations));
  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… âœ”ï¸");
}

/* â–‘â–‘â–’â–’ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ â–’â–’â–‘â–‘ */
function showErrors(){
  document.querySelectorAll('.item').forEach(i=>{
    i.style.display = i.querySelector('.result').innerText === 'âœ–ï¸'
      ? 'block' : 'none';
  });
}

/* â–‘â–‘â–’â–’ Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ Ù…Ù† Ø¬Ø¯ÙŠØ¯ â–’â–’â–‘â–‘ */
function resetView(){
  document.querySelectorAll('.item').forEach(i=>{
    i.style.display='block';
    i.querySelector('.result').innerText='';
  });
}

/* â–‘â–‘â–’â–’ ØªØ­Ù…ÙŠÙ„ Ø§ÙƒØ³Ù„ Ø¹Ø±Ø¨ÙŠ Ø¨Ø¯ÙˆÙ† ØªØ®Ø±ÙŠØ¨ â–’â–’â–‘â–‘ */
function downloadExcel(){
  if(evaluations.length===0) return alert("Ù…Ø§ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª");

  const rows=[["Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù","Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ù„Ø¨Ù†Ø¯","Ø§Ù„ØªÙ‚ÙŠÙŠÙ…","Ù…Ù„Ø§Ø­Ø¸Ø§Øª"]];
  evaluations.forEach(e => rows.push([e.name,e.date,e.criteria,e.score,e.notes]));

  const ws = XLSX.utils.aoa_to_sheet(rows);
  const wb = XLSX.utils.book_new();

  // Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙÙŠ Excel Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„
  Object.keys(ws).forEach(cell=>{
    if(cell[0]==='!')return;
    if(typeof ws[cell].v==='string'){
      ws[cell].v = "\ufeff"+ws[cell].v;
    }
  });

  XLSX.utils.book_append_sheet(wb,ws,"Ø§Ù„Ø´Ù‡Ø±");
  XLSX.writeFile(wb,"ØªÙ‚ÙŠÙŠÙ…Ø§Øª_Ø§Ù„Ø´Ù‡Ø±.xlsx",{compression:true});
}

/* â–‘â–‘â–’â–’ Ø­Ø°Ù Ø§Ù„Ø´Ù‡Ø± â–’â–’â–‘â–‘ */
function deleteAllData(){
  if(confirm("Ù‡Ù„ Ø§Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±ØŸ")){
    localStorage.removeItem("evaluations");
    evaluations=[];
    alert("ØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‡Ø± âœ”ï¸");
  }
}

/* â–‘â–‘â–’â–’ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ â–’â–’â–‘â–‘ */
function loadEmployeeNames(){
  const sel=document.getElementById("employeeSelect");
  sel.innerHTML="";
  employees.forEach(e=>{
    sel.innerHTML+=`<option>${e}</option>`;
  });
}

function addEmployee(){
  const name = prompt("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
  if(name){
    employees.push(name);
    loadEmployeeNames();
  }
}

function saveEmployees(){
  localStorage.setItem("employees",JSON.stringify(employees));
  alert("ØªÙ… Ø­ÙØ¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† âœ”ï¸");
}

/* â–‘â–‘â–’â–’ ØªØ´ØºÙŠÙ„ Ø§ÙˆÙ„ Ù…Ø±Ø© â–’â–’â–‘â–‘ */
renderCriteria();
loadEmployeeNames();

</script>

</body>
</html>
